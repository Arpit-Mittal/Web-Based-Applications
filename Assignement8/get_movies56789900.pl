#!/usr/bin/perl

print "content-type: application/xml \n\n";# Check whether LWP module is installed
if(eval{require LWP::Simple;}){}else{exit;}if ($ENV{'REQUEST_METHOD'} eq "GET") {$buffer = $ENV{'QUERY_STRING'};}$e = index($buffer,"="); $counter=1; $counter1=1; $counter2=1; $counter3=1; $url1 = "http://www.imdb.com/search/title?title=";if ( $e == -1 ){}else{@nvpairs = split(/&/, $buffer);foreach $pair (@nvpairs){($name, $value) = split(/=/, $pair);if (($value) eq "feature"){$value="feature"; $url3="&title_type=feature";$url4="$url1$url2$url3"; $flag1=0; $ flag2=0; $flag3=0; $content = LWP::Simple::get($url4); $image="NA"; $titlename="NA"; $year="NA"; $flag=0; $director="NA"; $rating="NA"; $detaillink="NA"; my @values = split('\n', $content);$pattern5="<a href=\"/title/";$pattern1="<a title=";$pattern4="<div class="; foreach my $val (@values) {if ($val =~ /$pattern5/){if ($val =~ /$pattern5/){if($val =~ m/title=\"(.*?)\(/) {$titlename=$1;if($val =~ m/title\/(.*?)\//){$a='http://www.imdb.com/title/'; $b='/'; $k=$a.$1.$b; $detaillink=$k; $content1 = LWP::Simple::get($k); my @values1 = split('\n', $content1); $temprating=11;$temprating1=12;foreach my $val1 (@values1){if($val1 =~ m/Directed by(.*?)\./){$temprating=$1; $director=$1; }if($val1 =~ m/Users rated this(.*?)\//){$temprating1=$1; $rating=$1;}}if($temprating==11){$director="NA";} if($temprating1==12){$rating="NA"; }}if($val =~ m/src=\"(.*?)\"/){$image=$1;} }if($val =~ m/\((.*?)\)/) {$year=$1; $flag=2;  if($counter le 5){if($counter==1){print "<?xml version=\"1.0\"?> \n"; print "<rsp stat=\"ok\">"; print "<results total=\"5\">";}print "<result cover=\"$image\" title=\"$titlename\" year=\"$year\" director=\"$director\" rating=\"$rating\" details=\"$detaillink\"/>"; $counter=$counter+1;}}}}}if($flag eq 2){print "<\/results>"; print "<\/rsp>";}if($flag eq 0){}}if (($value) eq "game"){$value="game"; $url3="&title_type=game";$url4="$url1$url2$url3";  $content = LWP::Simple::get($url4); $image="NA"; $titlename="NA"; $year="NA"; $director="NA"; $rating="NA"; $detaillink="NA"; my @values = split('\n', $content);$pattern5="<a href=\"/title/";$pattern1="<a title=";$pattern4="<div class="; foreach my $val (@values) {if ($val =~ /$pattern5/){if ($val =~ /$pattern5/){if($val =~ m/title=\"(.*?)\(/) {$titlename=$1;if($val =~ m/title\/(.*?)\//){$a='http://www.imdb.com/title/'; $b='/'; $k=$a.$1.$b; $detaillink=$k; $content1 = LWP::Simple::get($k); my @values1 = split('\n', $content1); $temprating=11;$temprating1=12;foreach my $val1 (@values1){if($val1 =~ m/Directed by(.*?)\./){$temprating=$1; $director=$1; }if($val1 =~ m/Users rated this(.*?)\//){$temprating1=$1; $rating=$1;}}if($temprating==11){$director="NA";} if($temprating1==12){$rating="NA"; }}if($val =~ m/src=\"(.*?)\"/){$image=$1;} }if($val =~ m/\((.*?)\)/) {$year=$1; $flag1=2; if($counter1==1){print "<?xml version=\"1.0\"?> \n"; print "<rsp stat=\"ok\">"; print "<results total=\"5\">";}  if($counter1 le 5){print "<result cover=\"$image\" title=\"$titlename\" year=\"$year\" director=\"$director\" rating=\"$rating\" details=\"$detaillink\"/>"; $counter1=$counter1+1;} }}}}if($flag1 eq 2){print "<\/results>"; print "<\/rsp>";}if($flag1 == 0){}}if (($value) eq "tv_series"){$value="tv_series"; $url3="&title_type=tv_series";$url4="$url1$url2$url3"; $content = LWP::Simple::get($url4); $image="NA"; $titlename="NA"; $year="NA"; $director="NA"; $rating="NA"; $detaillink="NA"; my @values = split('\n', $content);$pattern5="<a href=\"/title/";$pattern1="<a title=";$pattern4="<div class="; foreach my $val (@values) {if ($val =~ /$pattern5/){if ($val =~ /$pattern5/){if($val =~ m/title=\"(.*?)\(/) {$titlename=$1;if($val =~ m/title\/(.*?)\//){$a='http://www.imdb.com/title/'; $b='/'; $k=$a.$1.$b; $detaillink=$k; $content1 = LWP::Simple::get($k); my @values1 = split('\n', $content1); $temprating=11;$temprating1=12;foreach my $val1 (@values1){if($val1 =~ m/Directed by(.*?)\./){$temprating=$1; $director=$1; }if($val1 =~ m/Users rated this(.*?)\//){$temprating1=$1; $rating=$1;}}if($temprating==11){$director="NA";} if($temprating1==12){$rating="NA"; }}if($val =~ m/src=\"(.*?)\"/){$image=$1;} }if($val =~ m/\((.*?)\)/) {$year=$1; $flag2=2; if($counter2==1){print "<?xml version=\"1.0\"?> \n"; print "<rsp stat=\"ok\">"; print "<results total=\"5\">";} if($counter2 le 5){print "<result cover=\"$image\" title=\"$titlename\" year=\"$year\" director=\"$director\" rating=\"$rating\" details=\"$detaillink\"/>";  $counter2=$counter2+1;}}}}}if($flag2 eq 2){print "<\/results>"; print "<\/rsp>";}if($flag2 == 0){}}if (($value) eq "alltype"){$value="feature,tv_series,game"; $url3="&title_type=feature,tv_series,game";$url4="$url1$url2$url3";$content = LWP::Simple::get($url4); $image="NA"; $titlename="NA"; $year="NA"; $director="NA"; $rating="NA"; $detaillink="NA"; my @values = split('\n', $content);$pattern5="<a href=\"/title/";$pattern1="<a title=";$pattern4="<div class="; foreach my $val (@values) {if ($val =~ /$pattern5/){if ($val =~ /$pattern5/){if($val =~ m/title=\"(.*?)\(/) {$titlename=$1;if($val =~ m/title\/(.*?)\//){$a='http://www.imdb.com/title/'; $b='/'; $k=$a.$1.$b; $detaillink=$k; $content1 = LWP::Simple::get($k); my @values1 = split('\n', $content1); $temprating=11;$temprating1=12;foreach my $val1 (@values1){if($val1 =~ m/Directed by(.*?)\./){$temprating=$1; $director=$1; }if($val1 =~ m/Users rated this(.*?)\//){$temprating1=$1; $rating=$1;}}if($temprating==11){$director="NA";} if($temprating1==12){$rating="NA"; }}if($val =~ m/src=\"(.*?)\"/){$image=$1;} }if($val =~ m/\((.*?)\)/) {$year=$1; $flag3=2; if($counter3==1){print "<?xml version=\"1.0\"?> \n"; print "<rsp stat=\"ok\">"; print "<results total=\"5\">";} if($counter3 le 5){print "<result cover=\"$image\" title=\"$titlename\" year=\"$year\" director=\"$director\" rating=\"$rating\" details=\"$detaillink\"/>";  $counter3=$counter3+1; }}}}}if($flag3 == 2){print "<\/results>"; print "<\/rsp>";}if($flag3 == 0){}}else{$url2=$value;}}}